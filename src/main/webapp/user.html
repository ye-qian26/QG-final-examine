<!DOCTYPE html>
·
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>技术论坛</title>
    <style>
        .avatar-uploader .el-upload {
            border: 1px dashed #d9d9d9;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .avatar-uploader .el-upload:hover {
            border-color: #409EFF;
        }

        .avatar-uploader-icon {
            font-size: 28px;
            color: #8c939d;
            width: 178px;
            height: 178px;
            line-height: 178px;
            text-align: center;
        }

        .avatar {
            width: 178px;
            height: 178px;
            display: block;
        }

        .post-card {
            margin-bottom: 20px;
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .post-image {
            width: 20%;
            height: auto;
            margin-bottom: 10px;
        }

        .post-content {
            line-height: 1.5;
        }

    </style>

</head>
<body>
<div id="app">
    <el-menu
            :default-active="activeIndex"
            class="el-menu-demo"
            mode="horizontal"
            @select="handleSelect"
            background-color="#545c64"
            text-color="#fff"
            active-text-color="#ffd04b">
        <el-menu-item index="1" @click="changeMenuHomePage">主页</el-menu-item>

        <el-menu-item index="2" @click="changeMenuMyPlate">我的板块</el-menu-item>

        <el-menu-item index="3">个人信息中心</el-menu-item>
    </el-menu>

    <!--主页-->
    <div v-if="activeIndex === '1'">
        <h1>主页内容</h1>
        <el-form :inline="true" :model="plateForm" class="demo-form-inline">
            <el-form-item label="板块名">
                <el-input v-model="plateForm.vaguePlateName" placeholder="板块名称"></el-input>
            </el-form-item>
            <el-select v-model="plateValue" clearable placeholder="请选择">
                <el-option
                        v-for="item in plateOptions"
                        :key="item.plateValue"
                        :label="item.label"
                        :value="item.plateValue">
                </el-option>
            </el-select>
            <el-form-item>
                <el-button type="primary" @click="selectPlateByName">搜索</el-button>
            </el-form-item>
        </el-form>
        <el-tabs v-model="activeTab" @tab-click="handleHomePageTab">

            <el-tab-pane v-for="(plate, index) in plateData" :key="index" :label="plate.name" :name="plate.id">
                公告： {{ plate.notice }}<br>
                <el-form :inline="true" :model="postForm" class="demo-form-inline">
                    <el-form-item label="帖子内容">
                        <el-input v-model="postForm.vaguePostContent" placeholder="帖子内容"></el-input>
                    </el-form-item>
                    <el-select v-model="postValue" clearable placeholder="请选择">
                        <el-option
                                v-for="item in postOptions"
                                :key="item.postValue"
                                :label="item.label"
                                :value="item.postValue">
                        </el-option>
                    </el-select>
                    <el-form-item>
                        <el-button type="primary" @click="selectPostByContentAndPlateId">搜索</el-button>
                    </el-form-item>
                </el-form>
                <el-button type="primary" @click="issuePost">发布帖子</el-button>
                <!--点赞板块功能-->
                <el-button icon="el-icon-thumbs" :class="{ 'is-active': plate.isLiked }"
                           @click="togglePlateLike(plate)">
                    {{ plate.likes }} 点赞板块
                </el-button>
                <!-- 板块浏览量显示 -->
                {{ plate.pageView }} 浏览
                <el-card class="post-card" v-for="post in postData" :key="post.id">
                    <template #header>
                        <div class="post-header">
                            {{ post.username }}
                            {{ post.releaseTime }}
                            <div class="action-buttons">
                                <!-- 浏览量显示 -->
                                {{ post.pageView }} 浏览
                                <!--收藏功能-->
                                <el-button icon="el-icon-star" :class="{ 'is-active': post.isFavorited }"
                                           @click="toggleFavorite(post)">
                                    {{ post.isFavorited ? '已收藏' : '收藏' }}
                                </el-button>
                                <!--点赞功能-->
                                <el-button icon="el-icon-thumbs" :class="{ 'is-active': post.isLiked }"
                                           @click="toggleLike(post)">
                                    {{ post.likes }} 赞
                                </el-button>
                                <!--举报帖子功能-->
                                <el-button type="danger" plain @click="reportPostClick(post)">举报帖子</el-button>
                            </div>
                        </div>
                    </template>
                    <img :src="post.image" alt="Post Image" class="post-image"/>
                    <div class="post-content">{{ post.content }}</div>
                    <el-button type="success" @click="checkReview(post)">打开评论</el-button>
                </el-card>
            </el-tab-pane>
        </el-tabs>

    </div>

    <!--我的板块-->
    <div v-if="activeIndex === '2'">
        <h1>我的板块</h1>
        <el-button type="primary" @click="createPlateDialogVisible=true">创建板块</el-button>
        <el-tabs v-model="activeTab" @tab-click="handleTab">
            <el-tab-pane v-for="(plate, index) in plateData" :key="index" :label="plate.name" :name="plate.id">
                <el-form :model="form2" label-width="80px" :rules="rules">
                    <el-form-item label="板块公告" prop="notice">
                        <el-input type="textarea" v-model="form2.notice"></el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-button type='primary' @click="updatePlateNotice">保存</el-button>
                    </el-form-item>
                </el-form>
                <el-button type="primary" @click="createPostDialogVisible=true">发布帖子</el-button>
                <!--点赞板块功能-->
                <el-button icon="el-icon-thumbs" :class="{ 'is-active': plate.isLiked }"
                           @click="togglePlateLike(plate)">
                    {{ plate.likes }} 点赞板块
                </el-button>
                <!-- 板块浏览量显示 -->
                {{ plate.pageView }} 浏览
                <el-card class="post-card" v-for="post in postData" :key="post.id">
                    <template #header>
                        <div class="post-header">
                            {{ post.username }}
                            <div class="action-buttons">
                                <!-- 浏览量显示 -->
                                {{ post.pageView }} 浏览
                                <!--收藏功能-->
                                <el-button icon="el-icon-star" :class="{ 'is-active':    post.isFavorited }"
                                           @click="toggleFavorite(post)">
                                    {{ post.isFavorited ? '已收藏' : '收藏' }}
                                </el-button>
                                <!--点赞功能-->
                                <el-button icon="el-icon-thumbs" :class="{ 'is-active': post.isLiked }"
                                           @click="toggleLike(post)">
                                    {{ post.likes }} 赞
                                </el-button>
                                <el-button type="danger" plain @click="deletePost(post)">删除该帖子</el-button>
                            </div>
                        </div>
                    </template>
                    <img :src="post.image" alt="Post Image" class="post-image"/>
                    <div class="post-content">{{ post.content }}</div>

                    <el-button type="success" @click="checkReview(post)">打开评论</el-button>

                </el-card>
            </el-tab-pane>
        </el-tabs>
    </div>

    <!--个人信息中心-->
    <div class="info" v-if="activeIndex === '3'">
        <h1>个人信息中心</h1>
        <div v-if="user.role === '1'">
            <p>身份：普通用户</p>
        </div>
        <div v-else-if="user.role === '2'">
            <p>身份：管理员</p>
        </div>
        <el-upload
                class="avatar-uploader"
                action="http://localhost:8080/Technical-Forum/userServlet/uploadAvatar"
                :show-file-list="false"
                :on-success="handleAvatarSuccess"
                :before-upload="beforeAvatarUpload"
                :data="{id : user.id}">
            <el-image v-if="user.headPortrait" :src="user.headPortrait" class="avatar"></el-image>
            <i v-else class="el-icon-plus avatar-uploader-icon"></i>
        </el-upload>
        <el-form ref='nameForm' :model="form" label-width="60px" :rules="rules">
            <el-form-item label="昵称" prop="name">
                <el-input v-model="form.name"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type='primary' @click="updateUsername('nameForm')">保存</el-button>
            </el-form-item>
        </el-form>
        <el-button type='primary' @click="updateDialogVisible=true">设置密码</el-button>

        <!--帖子举报信息通知-->
        <el-button type='primary' @click="myFavoritePost">我的收藏</el-button>
        <el-button type="info" @click="infoClick1">帖子举报信息通知</el-button>
        <div v-if="user.role==='2'">
            <!--管理员-->
            <el-button type="info" @click="infoClick2">用户申请信息</el-button>
        </div>

    </div>

    <!--设置密码对话框-->
    <el-dialog
            title="设置密码"
            :visible.sync="updateDialogVisible"
            :before-close="handleClosePwd"
            width="30%"
            class="update-password-dialog"
    >
        <el-form ref="form1" :model="form" :rules="rules" label-width="80px">
            <el-form-item label="手机号" prop="tele">
                <el-input v-model="form.tele" disabled></el-input>
            </el-form-item>
            <el-form-item label="原密码" prop="password">
                <el-input placeholder="填写原密码" v-model="form.password" show-password></el-input>
            </el-form-item>
            <el-form-item label="新密码" prop="newPassword">
                <el-input placeholder="填写新密码" type="password" v-model="form.newPassword"
                          autocomplete="off"></el-input>
            </el-form-item>
            <el-form-item label="确认密码" prop="checkPassword">
                <el-input placeholder="再次填写确认" type="password" v-model="form.checkPassword"
                          autocomplete="off"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="updatePassword('form1')">提交</el-button>
                <el-button @click="handleClosePwd">取消</el-button>
            </el-form-item>
        </el-form>

    </el-dialog>
    <!--管理员信息通知对话框-->
    <el-dialog
            title="信息通知"
            :visible.sync="infoDialogVisible"
            :before-close="handleCloseInfo"
            width="60%"
    >
        <el-table
                :data="infoData"
                height="400"
                stripe
                style="width: 100%">
            <el-table-column
                    prop="userId"
                    label="用户id"
                    width="100">
            </el-table-column>
            <el-table-column
                    prop="username"
                    label="用户昵称"
                    width="150">
            </el-table-column>
            <el-table-column
                    prop="plateName"
                    label="欲创建板块名称"
                    width="150">
            </el-table-column>
            <el-table-column
                    prop="statusStr"
                    label="状态"
                    width="120">
            </el-table-column>
            <el-table-column
                    align="center"
                    label="操作">
                <el-row slot-scope="scope">
                    <div v-if="scope.row.statusStr==='未处理'">
                        <el-button type="primary" @click="allowAudit(scope.row)">允许</el-button>
                        <el-button type="danger" plain @click="unallowAudit(scope.row)">不允许</el-button>
                    </div>
                    <div v-else-if="scope.row.statusStr==='已处理'">
                        <el-button type="success" @click="deleteAuditById(scope.row)">清理</el-button>
                    </div>
                </el-row>
            </el-table-column>

        </el-table>
    </el-dialog>

    <!--创建板块对话框-->
    <el-dialog
            title="创建板块"
            :visible.sync="createPlateDialogVisible"
            :before-close="handleClosePlate"
            width="30%"
    >
        <el-form ref="form2" :model="form2" :rules="rules" label-width="80px">
            <el-form-item label="板块名称" prop="plateName">
                <el-input v-model="form2.plateName"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="createPlate('form2')">提交</el-button>
                <el-button @click="handleClosePlate">取消</el-button>
            </el-form-item>
        </el-form>
    </el-dialog>

    <!--发布帖子对话框-->
    <el-dialog
            title="发布帖子"
            :visible.sync="createPostDialogVisible"
            :before-close="handleClosePost"
            width="30%"
    >
        <el-form ref="form3" :model="form3" :rules="rules" label-width="80px">
            <el-form-item label="图片" prop="image">
                <el-upload
                        action="http://localhost:8080/Technical-Forum/postServlet/uploadAvatar"
                        :show-file-list="false"
                        :on-success="handleSuccess"
                        :before-upload="beforeAvatarUpload"
                >
                    <el-button size="small" type="primary">上传图片</el-button>
                </el-upload>
                <el-image v-if="form3.image" :src="form3.image" style="max-width: 100px; max-height: 100px;"></el-image>
            </el-form-item>
            <el-form-item label="帖子内容" prop="content">
                <el-input type="textarea" v-model="form3.content"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="createPost('form3')">提交</el-button>
                <el-button @click="handleClosePost">取消</el-button>
            </el-form-item>
        </el-form>
    </el-dialog>

    <!--评论对话框-->
    <el-dialog
            title="评论"
            :visible.sync="reviewDialogVisible"
            :before-close="handleCloseReview"
            width="40%"
    >
        <!-- 评论输入区域 -->
        <el-form ref="commentForm" :model="reviewForm" label-width="0px" :rules="rules">
            <el-form-item prop="reviewContent">
                <el-input type="textarea" v-model="reviewForm.reviewContent" placeholder="输入评论内容"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="addReview">发表评论</el-button>
            </el-form-item>
        </el-form>
        <!-- 评论列表 -->
        <div v-for="review in reviewData" :key="review.id" class="review-item">
            <div>
                <span>{{ review.username }}</span>：{{ review.content }}
            </div>
            <el-button icon="el-icon-thumbs" :class="{ 'is-active': review.isLiked }" @click="toggleReviewLike(review)">
                {{ review.likes }} 赞
            </el-button>
        </div>
    </el-dialog>


    <!--举报帖子对话框-->
    <el-dialog
            title="举报帖子"
            :visible.sync="reportPostDialogVisible"
            :before-close="handleCloseReportPost"
            width="40%"
    >
        <el-form ref="reportPostForm" :model="reportPostForm" :rules="rules" label-width="80px">

            <el-form-item label="举报内容" prop="reportContent">
                <el-input type="textarea" v-model="reportPostForm.reportContent"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="addReportPost('reportPostForm')">提交</el-button>
                <el-button @click="handleCloseReportPost">取消</el-button>
            </el-form-item>
        </el-form>
    </el-dialog>

    <!-- 帖子举报信息通知对话框 -->
    <el-dialog
            title="帖子举报信息"
            :visible.sync="reportPostInfoDialogVisible"
            :before-close="handleCloseReportPostInfo"
            width="40%"
    >
        <!-- 帖子举报信息列表 -->
        <div v-for="reportedPost in reportedPostData" :key="reportedPost.id" class="reportedPost-item">
            <div>
                <span>举报内容</span>：{{ reportedPost.reportContent }}
                <el-button type="success" @click="deleteReportedPostById(reportedPost.id)">忽略</el-button>
            </div>
            <el-link type="primary" @click="checkReportedPost(reportedPost)">查看帖子信息</el-link>
        </div>
    </el-dialog>

    <!-- 帖子详情对话框 -->
    <el-dialog
            title="帖子详情"
            :visible.sync="postDetailsDialogVisible"
            :before-close="handleClosePostDetails"
            width="50%"
    >
        <el-card class="post-card" v-for="post in detailPostData" :key="post.id">
            <template #header>
                <div class="post-header">
                    <span>{{ post.username }}</span>
                    <div class="action-buttons">
                        <!-- 浏览量显示 -->
                        <span>{{ post.pageView }} 浏览</span>
                        <div v-if="post.isUserBaned">
                            <el-button type="success" @click="unseal(post)">用户已封禁</el-button>
                        </div>
                        <div v-else>
                            <el-button type="primary" @click="addBan(post)">封禁用户</el-button>
                        </div>
                        <el-button type="danger" plain @click="deletePost(post)">删除该帖子</el-button>
                    </div>
                </div>
            </template>
            <img :src="post.image" alt="Post Image" class="post-image"/>
            <div class="post-content">{{ post.content }}</div>

            <el-button type="success" @click="checkReview(post)">打开评论</el-button>

        </el-card>
    </el-dialog>

    <!-- 我的收藏对话框 -->
    <el-dialog
            title="我的收藏"
            :visible.sync="myFavoritePostDialogVisible"
            :before-close="handleCloseMyFavoritePost"
            width="50%"
    >
        <el-card class="post-card" v-for="post in myFavoritePostData" :key="post.id">
            <template #header>
                <div class="post-header">
                    <span>{{ post.username }}</span>
                    <div class="action-buttons">
                        <!-- 浏览量显示 -->
                        <span>{{ post.pageView }} 浏览</span>
                        <!--收藏功能-->
                        <el-button icon="el-icon-star" :class="{ 'is-active':    post.isFavorited }"
                                   @click="toggleFavorite(post)">
                            {{ post.isFavorited ? '已收藏' : '收藏' }}
                        </el-button>
                        <!--点赞功能-->
                        <el-button icon="el-icon-thumbs" :class="{ 'is-active': post.isLiked }"
                                   @click="toggleLike(post)">
                            {{ post.likes }} 赞
                        </el-button>
                    </div>
                </div>
            </template>
            <img :src="post.image" alt="Post Image" class="post-image"/>
            <div class="post-content">{{ post.content }}</div>

            <el-button type="success" @click="checkReview(post)">打开评论</el-button>

        </el-card>
    </el-dialog>
</div>

<script src="js/vue.js"></script>
<script src="element-ui/lib/index.js"></script>
<script src="js/axios-0.18.0.js"></script>
<link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">

<script>

    new Vue({
        el: '#app',
        mounted() {
            console.log(this.user.username);
            this.selectAllPlate();
        },
        data() {
            //制定密码规则
            var validatePass = (rule, value, callback) => {
                if (value === '') {
                    callback(new Error('请输入密码'));
                } else {
                    if (this.checkPassword !== '') {
                        this.$refs.form.validateField('checkPassword');
                    }
                    callback();
                }
            };
            var validatePass2 = (rule, value, callback) => {
                if (value === '') {
                    callback(new Error('请再次输入密码'));
                } else if (value !== this.form.newPassword) {
                    callback(new Error('两次输入密码不一致!'));
                } else {
                    callback();
                }
            };
            return {
                //用户数据
                user: {
                    id: localStorage.getItem('id'),
                    username: localStorage.getItem('username'),
                    tele: localStorage.getItem('tele'),
                    password: '',
                    headPortrait: localStorage.getItem('headPortrait'),
                    role: localStorage.getItem('role'),
                    isBaned: false
                },
                //板块数据
                plate: {
                    id: '',
                    name: '',
                    userId: '',
                    notice: '',
                    pageView: '',
                    likes: '',
                    isLiked: false
                },
                //帖子数据
                post: {
                    id: '',
                    content: '',
                    image: '',
                    pageView: '',
                    likes: '',
                    plateId: '',
                    userId: '',
                    releaseTime:'',
                    isLiked: false,
                    isFavorited: false,
                    isUserBaned: false
                },
                //申请数据
                audit: {
                    id: '',
                    userId: '',
                    plateName: '',
                    status: '0'
                },
                //评论数据
                review: {
                    id: '',
                    content: '',
                    postId: '',
                    userId: '',
                    likes: '',
                    isLiked: false
                },
                //举报帖子数据
                reportedPost: {
                    id: '',
                    userId: '',
                    plateId: '',
                    postId: '',
                    reportContent: ''
                },
                //封禁数据
                ban: {
                    id: '',
                    userId: '',
                    plateId: ''
                },
                //表单数据
                form: {
                    name: localStorage.getItem('username'),
                    tele: localStorage.getItem('tele'),
                    role: localStorage.getItem('role'),
                    password: '',
                    newPassword: '',
                    checkPassword: ''
                },
                form2: {
                    plateName: '',
                    notice: ''
                },
                form3: {
                    content: '',
                    image: ''
                },
                //发布评论表单
                reviewForm: {
                    reviewContent: ''
                },
                //举报帖子表单
                reportPostForm: {
                    reportContent: ''
                },
                //搜索板块表单
                plateForm: {
                    vaguePlateName: ''
                },
                //搜索帖子表单
                postForm: {
                    vaguePostContent: ''
                },
                //信息表格
                infoData: [],
                //帖子集合
                postData: [],
                //临时帖子集合
                _postData: [],
                //板块集合
                plateData: [],
                //临时信息表格
                _infoData: [],
                //评论集合
                reviewData: [],
                //临时评论集合
                _reviewData: [],
                //帖子详情
                detailPostData: [],
                //举报帖子信息集合
                reportedPostData: [],
                //我的收藏帖子集合
                myFavoritePostData: [],
                //导航菜单索引
                activeIndex: '1',
                //头像url路径
                imageUrl: '',
                //设置密码对话框
                updateDialogVisible: false,
                //创建板块对话框
                createPlateDialogVisible: false,
                //信息通知对话框
                infoDialogVisible: false,
                //发布帖子对话框
                createPostDialogVisible: false,
                //评论对话框
                reviewDialogVisible: false,
                //举报帖子对话框
                reportPostDialogVisible: false,
                //帖子举报信息对话框
                reportPostInfoDialogVisible: false,
                //帖子详情对话框
                postDetailsDialogVisible: false,
                //我的收藏对话框
                myFavoritePostDialogVisible: false,
                //确认密码
                checkPassword: '',
                //用户ID到用户名的映射对象
                userMap: {},
                //标签导航
                activeTab: '',
                //主页标签导航
                homePageActiveTab: '',
                //临时帖子id
                _postId: '',
                //搜索帖子选择框
                postOptions: [{
                    postValue: '最新发布',
                    label: '最新发布'
                }, {
                    postValue: '最多浏览',
                    label: '最多浏览'
                },  {
                    postValue: '最多点赞',
                    label: '最多点赞'
                }],
                //搜索帖子选择内容
                postValue: '',
                //搜索板块选择框
                plateOptions: [{
                    plateValue: '最多浏览',
                    label: '最多浏览'
                },  {
                    plateValue: '最多点赞',
                    label: '最多点赞'
                }],
                //搜索板块选择内容
                plateValue: '',
                //输入规则
                rules: {
                    //昵称
                    name: [
                        {required: true, message: '请输入昵称', trigger: 'blur'}
                    ],
                    //板块名
                    plateName: [
                        {required: true, message: '板块名不能为空', trigger: 'blur'}
                    ],
                    //帖子内容
                    content: [
                        {required: true, message: '请输入帖子内容', trigger: 'blur'},
                        {max: 250, message: '该帖子内容过长', trigger: 'blur'}
                    ],
                    //举报帖子内容
                    reportContent: [
                        {required: true, message: '举报内容不能为空', trigger: 'blur'},
                        {max: 40, message: '举报内容过长', trigger: 'blur'}
                    ],
                    //评论内容
                    reviewContent: [
                        {required: true, message: '评论内容不能为空', trigger: 'blur'},
                        {max: 120, message: '评论内容过长', trigger: 'blur'}
                    ],
                    //板块公告内容
                    notice: [
                        {max: 250, message: '该公告内容过长', trigger: 'blur'}
                    ],
                    //图片
                    image: [
                        {required: true, message: '请上传图片', trigger: 'blur'}
                    ],
                    //密码规则
                    password: [
                        {required: true, message: '请输入密码', trigger: 'blur'},
                        {min: 8, max: 12, message: '长度需在8到12个字符之间', trigger: 'blur'}
                    ],
                    //密码规则
                    newPassword: [
                        {min: 8, max: 12, message: '长度需在8到12个字符之间', trigger: 'blur'},
                        {validator: validatePass, trigger: 'blur'}
                    ],
                    //再次输入密码规则
                    checkPassword: [
                        {validator: validatePass2, trigger: 'blur'}
                    ]
                },
            }
        },
        methods: {
            handleSelect(key) {
                this.activeIndex = key;
            },
            handleAvatarSuccess(res) {
                if (res.success) {
                    this.user.headPortrait = res.data.headPortraitPath;
                    //改变localStorage里面存储的信息
                    localStorage.setItem("headPortrait", this.user.headPortrait)
                    this.$message({
                        type: 'success',
                        message: '上传头像成功！'
                    })
                } else {
                    this.$message.error('上传头像失败，请稍后再试');
                }
            },
            handleSuccess(res) {
                if (res.success) {
                    this.form3.image = res.data.imagePath;

                    console.log(this.form3.image);
                    console.log(this.imageUrl);
                    this.$message({
                        type: 'success',
                        message: '上传图片成功！'
                    })
                } else {
                    this.$message.error('上传图片失败，请稍后再试');
                }
            },
            beforeAvatarUpload(file) {
                const isJPG = file.type === 'image/jpeg';
                const isLt2M = file.size / 1024 / 1024 < 2;

                if (!isJPG) {
                    this.$message.error('上传头像图片只能是 JPG 格式!');
                }
                if (!isLt2M) {
                    this.$message.error('上传头像图片大小不能超过 2MB!');
                }
                return isJPG && isLt2M;
            },
            //关闭对话框
            handleClosePwd() {
                this.updateDialogVisible = false;
                //重置表单中的密码信息
                this.form.password = '';
                this.form.newPassword = '';
                this.form.checkPassword = '';
            },
            handleCloseInfo() {
                this.infoDialogVisible = false;
            },
            handleClosePlate() {
                this.createPlateDialogVisible = false;
            },
            handleClosePost() {
                this.createPostDialogVisible = false;
            },
            handleCloseReview() {
                this.reviewDialogVisible = false;
                this.reviewData = null;
            },
            handleCloseReportPost() {
                this.reportPostDialogVisible = false;
                this.reportPostForm.reportContent = null;
            },
            handleCloseReportPostInfo() {
                this.reportPostInfoDialogVisible = false;
            },
            handleClosePostDetails() {
                this.postDetailsDialogVisible = false;
            },
            handleCloseMyFavoritePost(){
                this.myFavoritePostDialogVisible = false;
            },
            //点击举报帖子信息事件
            infoClick1() {
                this.selectReportedPostByUserId();
                this.reportPostInfoDialogVisible = true;
            },
            //点击信息通知事件
            infoClick2() {
                this.selectAllAudit();
                this.infoDialogVisible = true;
            },
            //切换至”主页“导航事件
            changeMenuHomePage() {
                this.activeTab = null;
                this.plateData = null;
                this.selectAllPlate();
            },
            //切换至”我的板块“导航事件
            changeMenuMyPlate() {
                this.activeTab = null;
                this.plateData = null;
                this.selectPlateByUserId();
            },
            //切换标签页事件
            async handleTab() {
                //查询板块公告
                this.selectPlateNoticeById();
                try {
                    await this.addPlatePageView();
                    //先查询帖子
                    await this.selectPostByPlateId();
                    //后查询收藏状态
                    await this.selectFavoritePost(this.postData)
                } catch (error) {
                    console.error('切换标签页执行过程中出错:', error);
                }
            },
            //主页切换标签页事件
            async handleHomePageTab() {
                try {
                    //增加板块浏览量
                    await this.addPlatePageView();
                    //先查询帖子
                    await this.selectPostByPlateId();
                    //后查询收藏状态
                    await this.selectFavoritePost(this.postData);
                } catch (error) {
                    console.error('切换标签页执行过程中出错:', error);
                }
            },
            // “我的收藏“ 点击事件
            myFavoritePost(){
                this.myFavoritePostDialogVisible = true;
            },
            //打开评论
            checkReview(post) {
                this._postId = post.id;
                this.reviewDialogVisible = true;
                //查询帖子对应的评论
                this.selectReviewByPostId(post.id);
                //增加浏览量
                this.addPostPageView(post);
            },
            //查看帖子详情
            async checkReportedPost(reportedPost) {
                this._postId = reportedPost.postId;
                await this.selectPostById();
                await this.selectBanByUserIdAndPlateId(this.detailPostData[0].userId, this.detailPostData[0].plateId);
                console.log(this.ban);
                this.postDetailsDialogVisible = true;
            },
            //修改昵称
            updateUsername(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        this.user.username = this.form.name;
                        //使用 axios 发送请求
                        axios({
                            method: 'get',
                            url: 'http://localhost:8080/Technical-Forum/userServlet/updateUsername?'
                                + "username=" + this.user.username + "&id=" + this.user.id
                        }).then(resp => {
                            if (resp.data === 'success') {
                                //修改成功
                                localStorage.setItem("username", this.user.username)
                                this.$message.success('昵称保存成功');
                            }
                        })
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                })

            },
            //修改密码
            updatePassword(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        //判断原密码是否正确
                        axios({
                            method: 'get',
                            url: 'http://localhost:8080/Technical-Forum/userServlet/loginUser?'
                                + "tele=" + this.user.tele + "&password=" + this.form.password
                        }).then(resp => {
                            if (resp.data !== 'fail') {
                                //原密码正确
                                //修改密码
                                axios({
                                    method: 'get',
                                    url: 'http://localhost:8080/Technical-Forum/userServlet/updateUserPassword?'
                                        + "password=" + this.form.newPassword + "&id=" + this.user.id
                                }).then(resp => {
                                    if (resp.data === 'success') {
                                        //修改成功
                                        this.$message.success('设置密码成功！');
                                    } else {
                                        //修改失败
                                        this.$message.error('请求失败，请稍后重试！');
                                    }
                                    //关闭对话框
                                    this.handleClosePwd();
                                })
                            } else {
                                //原密码错误
                                this.$message.error('原密码错误！')
                            }
                        })

                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                })
            },
            //用户创建板块
            createPlate(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        //存储到申请表中，等待管理员审核
                        this.audit.userId = this.user.id;
                        this.audit.plateName = this.form2.plateName;
                        axios({
                            method: 'post',
                            url: 'http://localhost:8080/Technical-Forum/auditServlet/addAudit',
                            data: this.audit
                        }).then(resp => {
                            if (resp.data === 'success') {
                                //添加成功
                                //消息提示
                                this.$message.success('已发送申请，请等待系统管理员审核...');
                                //关闭对话框
                                this.handleClosePlate();
                                this.form2.plateName = null;
                            }
                        })
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                })
            },
            //查询所有申请
            async selectAllAudit() {
                try {
                    const resp = await axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/auditServlet/selectAllAudit'
                    });
                    // 查询成功
                    this._infoData = resp.data;
                    // 构建用户ID到用户名的映射对象
                    this.userMap = await this.buildUserMap(this._infoData);
                    // 替换userId为用户名
                    this.replaceUserIdWithUsername(this._infoData);
                    this.infoData = this._infoData;
                    console.log(this.userMap);
                    console.log(this.infoData);
                } catch (error) {
                    console.error('查询申请时出错', error);
                }
            },
            //构建用户ID到用户名的映射对象
            async buildUserMap(infoData) {
                const userMap = {};
                for (const info of infoData) {
                    try {
                        const resp = await axios({
                            //发送ajax请求
                            method: 'get',
                            url: 'http://localhost:8080/Technical-Forum/userServlet/selectUserById',
                            params: {id: info.userId}
                        });
                        if (resp.data !== 'fail') {
                            userMap[info.userId] = resp.data.username;
                        }
                    } catch (error) {
                        console.error('获取用户信息时出错', error);
                    }
                }
                return userMap;
            },
            //替换userId为用户名
            replaceUserIdWithUsername(infoData) {
                infoData.forEach(info => {
                    console.log(this.userMap);
                    // console.log(this.userMap[2]);
                    //
                    info.username = this.userMap[info.userId] || '未知用户';
                });

            },
            //管理员允许创建板块
            allowAudit(row) {
                this.$confirm('确定允许该用户创建对应板块吗?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/plateServlet/addPlate',
                        params: {userId: row.userId, name: row.plateName}
                    }).then(resp => {
                        if (resp.data === 'success') {
                            //板块创建成功
                            this.$message.success('该板块创建成功！');
                            this.updateAuditStatus(row.id);
                        }
                    })
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消允许'
                    });
                });
            },
            //删除申请信息
            deleteAuditById(row) {
                this.$confirm('确认清理该数据吗?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/auditServlet/deleteAuditById',
                        params: {id: row.id}
                    }).then(resp => {
                        if (resp.data === 'success') {
                            //删除成功
                            this.$message.success('清理成功！')
                            //重新加载信息表格
                            this.selectAllAudit();
                        }
                    })
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消清理'
                    });
                });
            },
            //修改申请状态
            updateAuditStatus(id) {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/auditServlet/updateAuditStatus',
                    params: {id: id}
                }).then(resp => {
                    if (resp.data === 'success') {
                        //修改成功
                        //重新加载信息表格
                        this.selectAllAudit();
                    }
                })
            },
            //通过用户id查询板块
            selectPlateByUserId() {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/plateServlet/selectPlateByUserId',
                    params: {userId: this.user.id}
                }).then(resp => {
                    if (resp.data !== 'fail') {
                        //有数据
                        this.plateData = resp.data;
                    } else {
                        //无数据
                        this.$notify.info({
                            title: '消息',
                            message: '暂无所创建板块~'
                        });
                    }
                })
            },
            //根据plateId查询对应post
            async selectPostByPlateId() {
                try {
                    const resp = await axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/postServlet/selectPostByPlateId',
                        params: {plateId: this.activeTab}
                    });
                    if (resp.data !== 'fail') {
                        //有数据
                        this._postData = resp.data;
                        //显示作者
                        this.userMap = await this.buildUserMap(this._postData);
                        this.replaceUserIdWithUsername(this._postData);
                        this.postData = this._postData;
                    } else {
                        //无数据
                        this.postData = null;
                        //该板块暂无帖子
                        this.$notify.info({
                            title: '消息',
                            message: '该板块暂无帖子~'
                        });
                    }
                } catch (error) {
                    console.error('查询post时出错误', error);
                }
            },
            //发布帖子
            async issuePost() {
                //判断用户是否被封禁
                await this.selectBanByUserIdAndPlateId(this.user.id, this.activeTab);
                if (this.user.isBaned) {
                    //用户在此板块已被封禁
                    this.$message.warning('您在此板块已被版主封禁，无法发帖');
                } else this.createPostDialogVisible = true;
            },
            //添加帖子
            createPost(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios({
                            method: 'get',
                            url: 'http://localhost:8080/Technical-Forum/postServlet/addPost',
                            params: {
                                content: this.form3.content,
                                image: this.form3.image,
                                userId: this.user.id,
                                plateId: this.activeTab
                            }
                        }).then(resp => {
                            if (resp.data === 'success') {
                                //添加成功
                                //消息提示
                                this.$message.success('发布帖子成功！');
                                //关闭对话框
                                this.handleClosePost();
                                //重新加载数据
                                this.selectPostByPlateId();
                            }
                        })
                    } else {
                        this.$message.warning('内容未填写完');
                        return false;
                    }
                })
            },
            //修改板块公告
            updatePlateNotice() {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/plateServlet/updatePlateNotice',
                    params: {plateId: this.activeTab, notice: this.form2.notice}
                }).then(resp => {
                    if (resp.data === 'success') {
                    }
                    //修改成功
                    //消息提示
                    this.$message.success('板块公告保存成功！');
                })
            },
            //根据plateId查询notice
            selectPlateNoticeById() {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/plateServlet/selectPlateById',
                    params: {plateId: this.activeTab}
                }).then(resp => {
                    if (resp.data !== 'fail') {
                        //有数据
                        this.form2.notice = resp.data.notice;
                    }
                })
            },
            //删除帖子
            async deletePost(post) {
                this.$confirm('确认删除该帖子吗?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(async () => {
                    //删除对应收藏信息
                    await this.deleteFavoritePostByPostId(post.id);
                    //删除对应评论信息
                    await this.deleteReviewByPostId(post.id);
                    //删除对应举报帖子信息
                    await this.deleteReportedPostByPostId(post.id);
                    //删除帖子
                    await this.deletePostById(post.id);
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消删除'
                    });
                });
            },
            //根据帖子id删除帖子
            async deletePostById(postId) {
                try {
                    const resp = await axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/postServlet/deletePostById',
                        data: postId
                    })
                    if (resp.data === 'success') {
                        //删除成功
                        //消息提示
                        this.$message.success('删除帖子成功！');
                        //重新加载帖子数据
                        await this.selectPostByPlateId();
                        //关闭帖子详情对话框
                        this.postDetailsDialogVisible = false;
                        return resp.data;
                    }
                } catch (error) {
                    console.log('删除帖子时出错', error);
                }
            },
            // 切换点赞状态
            toggleLike(post) {
                post.isLiked = !post.isLiked;
                if (post.isLiked) {
                    //执行增加点赞量的方法
                    axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/postServlet/addPostLikesById',
                        data: post.id
                    }).then(resp => {
                        if (resp.data === 'success') {
                            //修改成功
                            post.likes++;
                        }
                    })
                } else {
                    //执行增加点赞量的方法
                    axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/postServlet/reducePostLikesById',
                        data: post.id
                    }).then(resp => {
                        if (resp.data === 'success') {
                            //修改成功
                            post.likes--;
                        }
                    })
                }
            },
            //切换评论点赞状态
            toggleReviewLike(review) {
                review.isLiked = !review.isLiked;
                if (review.isLiked) {
                    //执行增加评论点赞量的方法
                    axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/reviewServlet/addReviewLikesById',
                        data: review.id
                    }).then(resp => {
                        if (resp.data === 'success') {
                            //修改成功
                            review.likes++;
                        }
                    })
                } else {
                    //执行增加评论点赞量的方法
                    axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/reviewServlet/reduceReviewLikesById',
                        data: review.id
                    }).then(resp => {
                        if (resp.data === 'success') {
                            //修改成功
                            review.likes--;
                        }
                    })
                }
            },
            //发布评论
            addReview() {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/reviewServlet/addReview',
                    params: {content: this.reviewForm.reviewContent, userId: this.user.id, postId: this._postId}
                }).then(resp => {
                    if (resp.data === 'success') {
                        //发布评论成功
                        //消息提示
                        this.$message.success('发表评论成功！');
                        this.reviewForm.reviewContent = null;
                        //重新加载评论数据
                        this.selectReviewByPostId(this._postId);
                    } else if (resp.data === 'fail') {
                        //输入内容为空
                        this.$message.warning('评论内容不能为空');
                    }
                })
            },
            //根据postId查询对应review
            async selectReviewByPostId(postId) {
                const resp = await axios({
                    method: 'post',
                    url: 'http://localhost:8080/Technical-Forum/reviewServlet/selectReviewByPostId',
                    data: postId
                });
                if (resp.data !== 'fail') {
                    //有评论
                    // 查询成功
                    this._reviewData = resp.data;
                    // 构建用户ID到用户名的映射对象
                    this.userMap = await this.buildUserMap(this._reviewData);
                    // 替换userId为用户名
                    this.replaceUserIdWithUsername(this._reviewData);
                    this.reviewData = this._reviewData;
                } else {
                    this.$message.info('该帖子暂无评论');
                }
            },
            //查询帖子收藏状态
            async selectFavoritePost(postData) {
                postData.forEach(post => {
                    axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/favoritePostServlet/selectFavoritePost',
                        params: {userId: this.user.id, postId: post.id}
                    }).then(resp => {
                        post.isFavorited = resp.data !== 'fail';
                        //重新加载数据
                        this.$forceUpdate();
                    })
                })
                console.log(postData);
            },
            // 切换收藏状态
            toggleFavorite(post) {
                //console.log('Before update:', post.isFavorited);
                post.isFavorited = !post.isFavorited;
                this.$forceUpdate();
                //console.log('After update:', post.isFavorited);

                if (post.isFavorited) {
                    //用户点击了收藏
                    axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/favoritePostServlet/addFavoritePost',
                        params: {userId: this.user.id, postId: post.id}
                    }).then(resp => {
                        if (resp.data === 'success') {
                            //增加收藏成功
                            //消息提示
                            this.$message.success('收藏成功！');
                        }
                    })
                } else {
                    //用户取消了收藏
                    axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/favoritePostServlet/deleteFavoritePost',
                        params: {userId: this.user.id, postId: post.id}
                    }).then(resp => {
                        if (resp.data === 'success') {
                            //取消收藏成功
                            //消息提示
                            this.$message.success('已取消收藏！');
                        }
                    })
                }
            },
            //增加帖子浏览量
            addPostPageView(post) {
                axios({
                    method: 'post',
                    url: 'http://localhost:8080/Technical-Forum/postServlet/addPostPageView',
                    data: post.id
                }).then(resp => {
                    if (resp.data === 'success') {
                        //增加浏览量成功
                        post.pageView++;
                    }
                })
            },
            //查询所有板块
            selectAllPlate() {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/plateServlet/selectAllPlate'
                }).then(resp => {
                    if (resp.data !== 'fail') {
                        //有板块数据
                        this.plateData = resp.data;
                    }
                })
            },
            //举报帖子事件
            reportPostClick(post) {
                this._postId = post.id;
                this.reportPostDialogVisible = true;
                this.selectPlateById();
            },
            //根据板块id查询板块
            selectPlateById() {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/plateServlet/selectPlateById',
                    params: {plateId: this.activeTab}
                }).then(resp => {
                    if (resp.data !== 'fail') {
                        //有板块数据
                        this.plate = resp.data;
                    }
                })
            },
            //增加举报帖子
            addReportPost(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        this.reportedPost.userId = this.plate.userId;
                        this.reportedPost.plateId = this.activeTab;
                        this.reportedPost.postId = this._postId;
                        this.reportedPost.reportContent = this.reportPostForm.reportContent;
                        //发送ajax请求增加举报帖子
                        axios({
                            method: 'post',
                            url: 'http://localhost:8080/Technical-Forum/reportedPostServlet/addReportedPost',
                            data: this.reportedPost
                        }).then(resp => {
                            if (resp.data === 'success') {
                                //添加成功
                                //关闭对话框
                                this.reportPostDialogVisible = false;
                                //消息提示
                                this.$message.success('感谢您的举报，已反馈给版主！');
                            }
                        })
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                })
            },
            //通过用户id查询帖子举报信息
            selectReportedPostByUserId() {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/reportedPostServlet/selectByUserId',
                    params: {userId: this.user.id}
                }).then(resp => {
                    if (resp.data !== 'fail') {
                        //有帖子举报信息
                        this.reportedPostData = resp.data;
                    } else {
                        //没有帖子举报信息
                        //消息提示
                        this.reportedPostData = null;
                        this.$message.info('暂无帖子举报信息~');
                    }
                })
            },
            //通过帖子id查询帖子
            async selectPostById() {
                try {
                    const resp = await axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/postServlet/selectPostById',
                        params: {postId: this._postId}
                    })
                    if (resp.data !== 'fail') {
                        //有数据
                        this.detailPostData[0] = resp.data;
                        //渲染用户名
                        this.userMap = await this.buildUserMap(this.detailPostData);
                        // 替换userId为用户名
                        this.replaceUserIdWithUsername(this.detailPostData);
                    }
                } catch (error) {
                    console.error('获取帖子详情出错:', error);
                }

            },
            //忽略举报信息
            deleteReportedPostById(reportedPostId) {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/reportedPostServlet/deleteById',
                    params: {reportedPostId: reportedPostId}
                }).then(resp => {
                    if (resp.data === 'success') {
                        //忽略成功
                        this.$message.success('已忽略该举报信息');
                        //重新加载举报信息
                        this.selectReportedPostByUserId();
                    }
                })
            },
            //根据用户id和板块id查询封禁表
            async selectBanByUserIdAndPlateId(userId, plateId) {
                try {
                    const resp = await axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/banServlet/selectByUserIdAndPlateId',
                        params: {userId: userId, plateId: plateId}
                    })
                    if (resp.data !== 'fail') {
                        //有数据
                        this.ban = resp.data;
                        //改变用户是否被封禁的标记
                        this.user.isBaned = true;
                        this.detailPostData[0].isUserBaned = true;
                    } else {
                        //无数据
                        //改变用户是否被封禁的标记
                        this.user.isBaned = false;
                        this.detailPostData[0].isUserBaned = false;
                    }
                } catch (error) {
                    console.log('查询封禁表时出错', error);
                }
            },
            //增加封禁用户
            addBan(post) {
                console.log(post);
                this.$confirm('封禁后用户将无法在对应板块继续发帖，是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/banServlet/selectByUserIdAndPlateId',
                        params: {userId: post.userId, plateId: post.plateId}
                    }).then(resp => {
                        if (resp.data !== 'fail') {
                            //用户已被封禁
                            this.$message.info('该用户已被封禁过~');
                        } else {
                            //用户未被封禁
                            //判断是不是用户自己
                            if (this.user.id == post.userId) {
                                //是用户自己
                                console.log(this.ban);
                                this.$message.warning('很抱歉，该用户是您自己~');
                            } else {
                                //不是用户自己
                                //添加封禁用户
                                this.ban.userId = post.userId;
                                this.ban.plateId = post.plateId;
                                axios({
                                    method: 'post',
                                    url: 'http://localhost:8080/Technical-Forum/banServlet/addBan',
                                    data: this.ban
                                }).then(resp => {
                                    if (resp.data === 'success') {
                                        //封禁成功
                                        this.$message.success('封禁成功');
                                        //重新加载帖子详情
                                        post.isUserBaned = !post.isUserBaned;
                                        this.selectPostById();
                                        this.$forceUpdate();
                                    }
                                })
                            }
                        }
                    })
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消封禁'
                    });
                });
            },
            //解封用户
            unseal(post) {
                axios({
                    method: 'post',
                    url: 'http://localhost:8080/Technical-Forum/banServlet/deleteBan',
                    data: this.ban
                }).then(resp => {
                    if (resp.data === 'success') {
                        //删除成功
                        //消息提示
                        this.$message.success('解除封禁成功！');
                        //重新加载帖子详情
                        post.isUserBaned = !post.isUserBaned;
                        this.selectPostById();
                        this.$forceUpdate();
                    }
                })
            },
            //根据 帖子id 删除 收藏信息
            async deleteFavoritePostByPostId(postId) {
                try {
                    const resp = await axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/favoritePostServlet/deleteFavoritePostByPostId',
                        data: postId
                    })
                    if (resp.data !== 'success') {
                        this.$message.error('删除收藏信息时出错');
                    }
                    return resp.data;
                } catch (e) {
                    console.log('删除收藏信息时出异常', e);
                    return false;
                }
            },
            //根据 帖子id 删除评论信息
            async deleteReviewByPostId(postId) {
                try {
                    const resp = await axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/reviewServlet/deleteReviewByPostId',
                        data: postId
                    })
                    if (resp.data !== 'success') {
                        this.$message.error('删除评论信息时出错');
                    }
                    return resp.data;
                } catch (e) {
                    console.log('删除评论信息时出异常', e);
                    return false;
                }
            },
            //根据 帖子id 删除 举报帖子信息
            async deleteReportedPostByPostId(postId) {
                try {
                    const resp = await axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/reportedPostServlet/deleteReportedPostByPostId',
                        data: postId
                    })
                    if (resp.data === 'success') {
                        //重新加载举报信息
                        this.selectReportedPostByUserId();
                    } else {
                        this.$message.error('删除举报帖子信息时出错');
                    }
                    return resp.data;
                } catch (e) {
                    console.log('删除举报帖子信息时出异常', e);
                    return false;
                }
            },
            //根据 板块名 模糊查询 板块
            selectPlateByName() {
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/Technical-Forum/plateServlet/selectPlateByName',
                    params: {plateName : this.plateForm.vaguePlateName, select : this.plateValue}
                }).then(resp => {
                    if (resp.data !== 'fail') {
                        //有数据
                        this.plateData = resp.data;
                    } else {
                        //无数据
                        this.$message.error('未找到相关内容的板块');
                    }
                })
            },
            //根据 帖子内容 模糊查询 帖子
            async selectPostByContentAndPlateId() {
                try {
                    const resp = await axios({
                        method: 'get',
                        url: 'http://localhost:8080/Technical-Forum/postServlet/selectPostByContentAndPlateId',
                        params: {content: this.postForm.vaguePostContent, plateId: this.activeTab, select: this.postValue}
                    })
                    if (resp.data !== 'fail') {
                        //有数据
                        this._postData = resp.data;
                        //显示作者
                        this.userMap = await this.buildUserMap(this._postData);
                        this.replaceUserIdWithUsername(this._postData);
                        //加载帖子收藏状态
                        await this.selectFavoritePost(this._postData);
                        this.postData = this._postData;
                        return resp.data;
                    } else {
                        this.$message.error('没有搜索到相关内容');
                    }
                } catch (e) {
                    console.log('搜索帖子时报异常',e);
                }

            },
            //切换板块点赞状态
            togglePlateLike(plate) {
                plate.isLiked = !plate.isLiked;
                if (plate.isLiked) {
                    //增加板块点赞量
                    axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/plateServlet/addPlateLikesById',
                        data: plate.id
                    }).then(resp => {
                        if (resp.data === 'success') {
                            plate.likes++;
                        }
                    })
                } else {
                    //减少板块点赞量
                    axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/plateServlet/reducePlateLikesById',
                        data: plate.id
                    }).then(resp => {
                        if (resp.data === 'success') {
                            plate.likes--;
                        }
                    })
                }
            },
            //增加 板块 浏览量
            async addPlatePageView() {
                try {
                    const resp = await axios({
                        method: 'post',
                        url: 'http://localhost:8080/Technical-Forum/plateServlet/addPlatePageView',
                        data: this.activeTab
                    })
                    if (resp.data !== 'success') {
                        this.$message.warning('增加板块浏览量时出错');
                    }
                    return resp.data;
                } catch (e) {
                    console.log('增加板块浏览量时报异常'.e);
                    return false;
                }
            }
        }
    })


</script>
</body>
</html>